# USOEPI ウソエピ

写真の要素を使った実話・フェイク混在の三択クイズゲームです。AIが写真から要素を検出し、ユーザーの実話と紛らわしいフェイク2つを自動生成します。

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 環境変数の設定

`.env.local`ファイルを作成し、OpenAI APIキーを設定してください：

```bash
# .env.localファイルをコピー
cp .env.local.example .env.local

# .env.localを編集してAPIキーを設定
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

APIキーは[OpenAI Platform](https://platform.openai.com/api-keys)から取得できます。

### 3. 開発サーバーの起動

```bash
npm run dev
```

http://localhost:3000 でアプリケーションが起動します。

## 機能詳細

### ゲームフロー
1. **プレイヤー登録**：2〜8名まで登録可能（重複不可）
2. **出題者選択**：各ラウンドの出題者を選択
3. **写真アップ & 実話作成**：
   - 写真をアップロード（5MB制限）
   - AI が画像解析中はローディング画面でブロック
   - 検出された要素から1つ選択
   - 選択した要素について実話を入力（最大100字）
   - AIが実話を20-40字の過去体験文に整形
4. **フェイク生成**：選択されなかった要素から2つのフェイクエピソードを自動生成
5. **三択投票**：出題者以外の全員が投票
6. **結果発表**：正解者に祝福メッセージ、全員外した場合は出題者を称賛

### 主要機能
- **スマート画像解析**：人物、物体、植物、道具などを最大7個検出
- **重複防止システム**：同種の物体は1つにまとめ、選択した要素はフェイクに使用不可
- **パーソナライズメッセージ**：正解者への祝福、不正解者への煽り、出題者への称賛
- **ローディング状態管理**：画像解析中はUI操作をブロック
- **セッション保持**：ページ更新してもプレイヤー情報を維持

## 技術スタック

- **フロントエンド**: Next.js 15.3.3 + React 19 + TypeScript
- **スタイリング**: Tailwind CSS + カスタムCSS変数
- **AI統合**: 
  - OpenAI Vision API (gpt-4o-mini) - 画像解析
  - OpenAI Chat API (gpt-4o) - テキスト生成・整形
- **データ保存**: sessionStorage（ローカルのみ）
- **ランタイム**: Edge Runtime（全APIルート）

## API仕様

### `/api/vision` - 画像解析
- 写真から物体検出
- 重複タグ除去機能
- JSON形式でオブジェクトリスト返却

### `/api/normalize` - 実話整形  
- ユーザー入力を20-40字の過去体験文に変換
- 個人名・会社名の一般化

### `/api/fakes` - フェイク生成
- 選択要素を除外した残り要素からフェイク2本生成
- 1つの要素につき1つのフェイク（組み合わせ禁止）
- ユーザー視点の過去体験として生成

## 注意事項

- APIキーなしの場合はモック動作
- 画像は5MB以下推奨
- すべてのデータは端末内保存のみ
- フェイクは選択した要素と物理的に重複しない設計